<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agar.io Melhorado</title>
  <style>
    body{margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh;overflow:hidden}
    #gameContainer{position:relative;width:100vw;height:100vh;background:#001122}
    #gameCanvas{width:100%;height:100%}
    #ui{position:absolute;top:10px;left:10px;color:#fff;font-family:sans-serif;font-size:16px;z-index:10}
    #instructions{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,.7);padding:20px;border-radius:10px;color:#fff;text-align:center}
    #instructions button{margin-top:10px;padding:10px 20px;font-size:18px}
    #gameOver{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,0,0,.8);padding:20px;border-radius:10px;color:#fff;display:none}
    #minimapWrap{position:absolute;right:10px;top:10px;z-index:20;background:rgba(0,0,0,.6);padding:4px;border-radius:8px;display:none}
    #minimap{width:180px;height:130px;display:block}
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas"></canvas>
    <div id="ui" style="display:none">
      Pontua√ß√£o: <span id="score">0</span> | Massa: <span id="mass">10</span>
    </div>
    <div id="instructions">
      <h2>ü¶† Agar.io Melhorado</h2>
      <p>Toque para mover ‚Ä¢ Espa√ßo: dividir ‚Ä¢ R: reunir</p>
      <button id="startBtn">COME√áAR</button>
    </div>
    <div id="gameOver">
      <h2>Game Over</h2>
      <p>Pontua√ß√£o Final: <span id="finalScore">0</span></p>
      <p>Massa Final: <span id="finalMass">0</span></p>
      <button onclick="startGame()">Jogar Novamente</button>
    </div>
    <div id="minimapWrap">
      <canvas id="minimap" width="180" height="130"></canvas>
    </div>
  </div>
<script>
let canvas=document.getElementById("gameCanvas"),ctx=canvas.getContext("2d");
let minimap=document.getElementById("minimap"),mctx=minimap.getContext("2d");
canvas.width=window.innerWidth;canvas.height=window.innerHeight;

const WORLD_WIDTH=2000,WORLD_HEIGHT=1500;
let gameRunning=false,player,enemies=[],food=[];
let score=0;let best=0;

function massToRadius(m){return Math.sqrt(m)*2+5}
function reset(){
  player={x:WORLD_WIDTH/2,y:WORLD_HEIGHT/2,mass:20,radius:massToRadius(20)};
  enemies=[];
  for(let i=0;i<15;i++){spawnEnemy()}
  food=[];for(let i=0;i<300;i++){food.push({x:Math.random()*WORLD_WIDTH,y:Math.random()*WORLD_HEIGHT,radius:5})}
  score=0;
}
function spawnEnemy(){
  const m=30+Math.random()*40;
  enemies.push({x:Math.random()*WORLD_WIDTH,y:Math.random()*WORLD_HEIGHT,mass:m,radius:massToRadius(m),vx:Math.random()*2-1,vy:Math.random()*2-1});
}
function startGame(){
  reset();
  gameRunning=true;
  document.getElementById("instructions").style.display="none";
  document.getElementById("gameOver").style.display="none";
  document.getElementById("ui").style.display="block";
  document.getElementById("minimapWrap").style.display="block";
  requestAnimationFrame(loop);
}
function endGame(){
  gameRunning=false;
  document.getElementById("finalScore").textContent=score;
  document.getElementById("finalMass").textContent=Math.floor(player.mass);
  document.getElementById("gameOver").style.display="block";
  document.getElementById("ui").style.display="none";
  document.getElementById("minimapWrap").style.display="none";
}
document.getElementById("startBtn").onclick=startGame;

let mouse={x:WORLD_WIDTH/2,y:WORLD_HEIGHT/2};
canvas.addEventListener("mousemove",e=>{mouse.x=e.clientX;mouse.y=e.clientY});

function loop(){
  if(!gameRunning) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="lime";
  ctx.beginPath();
  ctx.arc(player.x,player.y,player.radius,0,Math.PI*2);
  ctx.fill();

  for(let i=food.length-1;i>=0;i--){
    let f=food[i];
    ctx.fillStyle="yellow";
    ctx.beginPath();
    ctx.arc(f.x,f.y,f.radius,0,Math.PI*2);
    ctx.fill();
    if(dist(player,f)<player.radius){
      player.mass+=1;player.radius=massToRadius(player.mass);
      score++;food.splice(i,1);
    }
  }

  enemies.forEach(e=>{
    e.x+=e.vx;e.y+=e.vy;
    if(e.x<0||e.x>WORLD_WIDTH) e.vx*=-1;
    if(e.y<0||e.y>WORLD_HEIGHT) e.vy*=-1;
    ctx.fillStyle="red";
    ctx.beginPath();
    ctx.arc(e.x,e.y,e.radius,0,Math.PI*2);
    ctx.fill();
    if(dist(player,e)<player.radius&&player.mass>e.mass){
      player.mass+=e.mass*0.5;player.radius=massToRadius(player.mass);
      score+=20;e.mass=30; // respawn
      e.x=Math.random()*WORLD_WIDTH;e.y=Math.random()*WORLD_HEIGHT;
    }else if(dist(player,e)<e.radius){
      endGame();
    }
  });

  document.getElementById("score").textContent=score;
  document.getElementById("mass").textContent=Math.floor(player.mass);
  drawMinimap();
  requestAnimationFrame(loop);
}
function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}
function drawMinimap(){
  mctx.clearRect(0,0,minimap.width,minimap.height);
  const scaleX=minimap.width/WORLD_WIDTH;
  const scaleY=minimap.height/WORLD_HEIGHT;
  mctx.fillStyle="lime";
  mctx.beginPath();
  mctx.arc(player.x*scaleX,player.y*scaleY,3,0,Math.PI*2);mctx.fill();
  mctx.fillStyle="red";
  enemies.forEach(e=>{mctx.beginPath();mctx.arc(e.x*scaleX,e.y*scaleY,2,0,Math.PI*2);mctx.fill();});
}
</script>
</body>
</html>